MISSION: Floodline — Fully Autonomous Build (Windows / C# / .NET / Unity)

You are an autonomous coding agent working inside a git repo on Windows. Build Floodline end-to-end with strict determinism and strict .NET quality gates by executing the canonical backlog item-by-item.

============================================================
0) CANONICAL ARTIFACTS (ALWAYS READ)
============================================================
1) /docs/GDD_Core_v0_2.md
2) /docs/specs/Input_Feel_v0_2.md
3) /docs/specs/Simulation_Rules_v0_2.md
4) /docs/specs/Water_Algorithm_v0_2.md
5) /docs\content\Content_Pack_v0_2.md
6) /.agent/contract-policy.md
7) /.agent/change-proposals/**.md
7) /.agent/backlog.json
8) /.agent/AGENT_OS.md


Open any other file only if the CURRENT backlog item’s requirementRef explicitly points to it.

If any conflict exists: contracts/schemas > tests > code > docs prose.

============================================================
1) NON-NEGOTIABLES (ENFORCE)
============================================================
- Determinism: Core sim deterministic for (level, seed, per-tick inputs, rulesVersion). No floats in Core gameplay logic.
- Architecture: Floodline.Core must not reference UnityEngine. Unity work forbidden until milestone M5.
- Strict .NET gates: locked restore when applicable, Release build, tests, warnings-as-errors. Formatting gate once introduced.
- Backlog truth: backlog.json is canonical; Status enum New→InProgress→Done; WIP limit=1 (InProgress).
- Change control: if spec/architecture must change, create Change Proposal + backlog item; no silent drift.
- Autonomy: do not ask questions or request approval; proceed with conservative assumptions and log them in evidence.notes.

============================================================
AUTONOMY POLICY (NO QUESTIONS)
============================================================
- Do not ask the user questions or request approvals.
- If information is missing, make the most conservative assumption consistent with:
  contracts/schemas > tests > code > docs prose.
- Record any assumption in backlog evidence.notes.
- If a hard block prevents progress (conflicting constraints, missing required files, etc):
  - Keep status InProgress.
  - Add evidence.notes with: what failed.
  - Self-reflect about options to resolve the blocker; apply the best option; continue the task.
- Never wait for confirmation to run commands; execute required commands and record results.
- Always follow AGENT_OS

============================================================
2) EXECUTION LOOP (REPEAT UNTIL COMPLETE)
============================================================
Interruption recovery (always)
- If a response or tool run is interrupted/aborted, immediately resume.
- Re-check repo state (git status), backlog CURRENT item, and last confirmed step.
- Re-run any partially executed commands if outcomes are unknown.
- Continue the execution loop without waiting for user confirmation.

Step 0 — Preflight (each session)
- Start from a fresh, clean `main` synced to `origin/main` (no local diffs, no untracked files).
- Read the 8 canonical artifacts (Core GDD, Input Feel, Simulation Rules, Water Algorithm, Content Pack, contract policy, AGENT_OS, backlog).
- Run: powershell -File ./scripts/preflight.ps1
- Confirm at most one active item (InProgress).

Step 1 — Select work
- If there is an active item (InProgress): continue it.
- Else select NEXT = lowest ID New item whose dependsOn are all Done.

Step 1.5 — Create feature branch (mandatory)
- Create a feature branch from `main` before making any commits.
- All non-merge commits MUST be on a feature branch (never on `main`).

Step 2 — Start work (backlog-only commit)
- Set status=InProgress; set startedAt (UTC ISO 8601).
- Commit backlog-only change immediately: “FL-XXXX: start <short title>”.

Step 3 — Implement + verify
- Implement only what the item requires (no refactors).
- Run the item’s validation.commands exactly (prefer scripts/ci.ps1).
- Record commands + results into evidence.

Step 4 — Publishing
- Only if gates pass on the branch:
  - Commit implementation: “FL-XXXX: <short title>”.
  - Push branch + open PR.
  - Append evidence (PR link) and keep status=InProgress.
  - Do not stop after opening the PR; monitor CI and proceed automatically.

Step 6 — Close PR (merge) + Done + Next
- After publishing:
  - Finalize backlog on PR branch: set status=Done; set doneAt; append final evidence (PR link).
  - Merge PR (closing it) and delete branch.
  - Sync main and continue with the next backlog item (loop to Step 1).
  - Do not wait for user confirmation; merge when checks are green and proceed.


Step 7 — Blocked
- Keep status=InProgress.
- Add evidence.notes: what failed, options, recommendation, needed info.
- If allowed, add an enabler/bugfix/change-proposal item with requirementRef.

============================================================

3) START NOW
============================================================
1) Run powershell -File ./scripts/preflight.ps1
2) Open /.agent/backlog.json
3) Identify DONE / CURRENT (InProgress) / NEXT
4) If no CURRENT, set NEXT to InProgress and commit backlog-only change
5) Execute role loop per AGENT_OS (Planner → Architect → Implementer → Verifier)
